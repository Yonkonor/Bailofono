<!DOCTYPE html>
<html>
<head>
	<title>Generador de sonidos</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<h1>Generador de sonidos</h1>
	<div id="meter-container">
		<div id="meter"></div>
	</div>
	<button id="play-button">Reproducir</button>
	<button id="stop-button">Detener</button>
	<script src="script.js"></script>
</body>
</html>
body {
	margin: 0;
	padding: 0;
	background-color: #F4F4F4;
	font-family: Arial, sans-serif;
	text-align: center;
}
h1 {
	margin-top: 20px;
}
#meter-container {
	margin-top: 50px;
	position: relative;
	width: 100%;
	height: 50px;
	background-color: #FFFFFF;
	box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
}
#meter {
	position: absolute;
	top: 0;
	left: 0;
	height: 100%;
	background-color: #9BC53D;
}
button {
	margin-top: 20px;
	padding: 10px 20px;
	background-color: #3D8EB9;
	color: #FFFFFF;
	border: none;
	border-radius: 5px;
	font-size: 16px;
	cursor: pointer;
}
// Se obtiene el objeto del acelerómetro del dispositivo
var accelerometer = window.DeviceMotionEvent;

// Se define la frecuencia del tono (en Hz)
var toneFrequency = 300;

// Se define el contexto de audio
var audioContext = new (window.AudioContext || window.webkitAudioContext)();

// Se define el oscilador que generará el tono
var oscillator = null;

// Se define la ganancia que modifica la intensidad del sonido
var gainNode = audioContext.createGain();

// Se obtienen los elementos de la página
var meter = document.getElementById("meter");
var playButton = document.getElementById("play-button");
var stopButton = document.getElementById("stop-button");

// Se define la función que se encarga de generar el tono
function generateTone(z) {
	// Se calcula la intensidad del sonido a partir de la componente Z del acelerómetro
	var intensity = Math.abs(z) / 10;

	// Se modifica la ganancia del sonido de acuerdo a la intensidad calculada
	gainNode.gain.value = intensity;

	// Se crea el oscilador si no existe y se le asigna la frecuencia del tono
	if (oscillator === null) {
		oscillator = audioContext.createOscillator();
		oscillator.type = "sine";
		oscillator.frequency.value = toneFrequency;
		oscillator.connect(gainNode);
		gainNode.connect(audioContext.destination);
	}

	// Se inicia el oscilador si no está sonando
	if (oscillator.state === "suspended") {
		oscillator.start();
	}

	// Se actualiza la posición del medidor de intensidad
	var meterWidth = Math.round(intensity * 100);
	meter.style.width = meterWidth + "%";
}

// Se define la función que se encarga de detener el tono
function stopTone() {
	if (oscillator !== null) {
		oscillator.stop();
		oscillator.disconnect();
		oscillator = null;
		gainNode.disconnect();
		gainNode = audioContext.createGain();
		meter.style.width = "0%";
	}
}

// Se agrega un escucha de eventos al botón de reproducir
playButton.addEventListener("click", function() {
	// Se verifica si el acelerómetro está disponible
	if (accelerometer) {
		// Se agrega un escucha de eventos al evento de cambio de datos del acelerómetro
		window.addEventListener("devicemotion", function(event) {
			// Se obtiene el valor de la componente Z del acelerómetro
			var z = event.accelerationIncludingGravity.z;

			// Se genera el tono con la intensidad correspondiente a la componente Z
			generateTone(z);
		});
	}

	// Se deshabilita el botón de reproducir y se habilita el de detener
	playButton.disabled = true;
	stopButton.disabled = false;
});

// Se agrega un escucha de eventos al botón de detener
stopButton.addEventListener("click", function() {
	// Se detiene el tono
	stopTone();

	// Se habilita el botón de reproducir y se deshabilita el de detener
	playButton.disabled = false;
	stopButton.disabled = true;
});
</body>
</html>
